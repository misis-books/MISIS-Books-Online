(function(c){c.fn.styler=function(k){k=c.extend({wrapper:"form",idSuffix:"-styler",filePlaceholder:"\u0424\u0430\u0439\u043b \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d",fileBrowse:"\u041e\u0431\u0437\u043e\u0440...",selectSearch:!0,selectSearchLimit:10,selectSearchNotFound:"\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e",selectSearchPlaceholder:"\u041f\u043e\u0438\u0441\u043a...",selectVisibleOptions:0,singleSelectzIndex:"100",
selectSmartPositioning:!0},k);return this.each(function(){function s(){var c="",p="",b="",u="";void 0!==a.attr("id")&&""!=a.attr("id")&&(c=' id="'+a.attr("id")+k.idSuffix+'"');void 0!==a.attr("title")&&""!=a.attr("title")&&(p=' title="'+a.attr("title")+'"');void 0!==a.attr("class")&&""!=a.attr("class")&&(b=" "+a.attr("class"));var s=a.data(),f;for(f in s)""!=s[f]&&(u+=" data-"+f+'="'+s[f]+'"');this.id=c+u;this.title=p;this.classes=b}var a=c(this);a.is(":checkbox")?a.each(function(){if(1>a.parent("div.jq-checkbox").length){var k=
function(){var k=new s,b=c("<div"+k.id+' class="jq-checkbox'+k.classes+'"'+k.title+'><div class="jq-checkbox__div"></div></div>');a.css({position:"absolute",zIndex:"-1",opacity:0,margin:0,padding:0}).after(b).prependTo(b);b.attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none",display:"inline-block",position:"relative",overflow:"hidden"});a.is(":checked")&&b.addClass("checked");a.is(":disabled")&&
b.addClass("disabled");b.click(function(){b.is(".disabled")||(a.is(":checked")?(a.prop("checked",!1),b.removeClass("checked")):(a.prop("checked",!0),b.addClass("checked")),a.change());return!1});a.closest("label").add('label[for="'+a.attr("id")+'"]').click(function(a){b.click();a.preventDefault()});a.change(function(){a.is(":checked")?b.addClass("checked"):b.removeClass("checked")}).keydown(function(a){13!=a.which&&32!=a.which||b.click()}).focus(function(){b.is(".disabled")||b.addClass("focused")}).blur(function(){b.removeClass("focused")})};
k();a.on("refresh",function(){a.parent().before(a).remove();k()})}}):a.is(":radio")?a.each(function(){if(1>a.parent("div.jq-radio").length){var n=function(){var p=new s,b=c("<div"+p.id+' class="jq-radio'+p.classes+'"'+p.title+'><div class="jq-radio__div"></div></div>');a.css({position:"absolute",zIndex:"-1",opacity:0,margin:0,padding:0}).after(b).prependTo(b);b.attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none",
display:"inline-block",position:"relative"});a.is(":checked")&&b.addClass("checked");a.is(":disabled")&&b.addClass("disabled");b.click(function(){b.is(".disabled")||(b.closest(k.wrapper).find('input[name="'+a.attr("name")+'"]').prop("checked",!1).parent().removeClass("checked"),a.prop("checked",!0).parent().addClass("checked"),a.change());return!1});a.closest("label").add('label[for="'+a.attr("id")+'"]').click(function(a){b.click();a.preventDefault()});a.change(function(){a.parent().addClass("checked")}).focus(function(){b.is(".disabled")||
b.addClass("focused")}).blur(function(){b.removeClass("focused")})};n();a.on("refresh",function(){a.parent().before(a).remove();n()})}}):a.is(":file")?a.css({position:"absolute",top:0,right:0,width:"100%",height:"100%",opacity:0,margin:0,padding:0}).each(function(){if(1>a.parent("div.jq-file").length){var n=function(){var p=new s,b=c("<div"+p.id+' class="jq-file'+p.classes+'"'+p.title+' style="display: inline-block; position: relative; overflow: hidden"></div>'),n=c('<div class="jq-file__name">'+
k.filePlaceholder+"</div>").appendTo(b);c('<div class="jq-file__browse">'+k.fileBrowse+"</div>").appendTo(b);a.after(b);b.append(a);a.is(":disabled")&&b.addClass("disabled");a.change(function(){n.text(a.val().replace(/.+[\\\/]/,""))}).focus(function(){b.addClass("focused")}).blur(function(){b.removeClass("focused")}).click(function(){b.removeClass("focused")})};n();a.on("refresh",function(){a.parent().before(a).remove();n()})}}):a.is("select")?a.each(function(){if(1>a.next("div.jqselect").length){var n=
function(){function p(a){a.unbind("mousewheel DOMMouseScroll").bind("mousewheel DOMMouseScroll",function(a){var b=null;"mousewheel"==a.type?b=-1*a.originalEvent.wheelDelta:"DOMMouseScroll"==a.type&&(b=40*a.originalEvent.detail);b&&(a.stopPropagation(),a.preventDefault(),c(this).scrollTop(b+c(this).scrollTop()))})}function b(){i=0;for(len=f.length;i<len;i++){var a="",c="",b=a="",k="",g="";f.eq(i).prop("selected")&&(c="selected sel");f.eq(i).is(":disabled")&&(c="disabled");f.eq(i).is(":selected:disabled")&&
(c="selected sel disabled");void 0!==f.eq(i).attr("class")&&(b=" "+f.eq(i).attr("class"),g=' data-jqfs-class="'+f.eq(i).attr("class")+'"');var p=f.eq(i).data(),h;for(h in p)""!=p[h]&&(a+=" data-"+h+'="'+p[h]+'"');a="<li"+g+a+' class="'+c+b+'"><div class="bubble category'+(i+1)+'_menu"></div>'+f.eq(i).text()+"</li>";f.eq(i).parent().is("optgroup")&&(void 0!==f.eq(i).parent().attr("class")&&(k=" "+f.eq(i).parent().attr("class")),a="<li"+g+' class="'+c+b+" option"+k+'">'+f.eq(i).text()+"</li>",f.eq(i).is(":first-child")&&
(a='<li class="optgroup'+k+'">'+f.eq(i).parent().attr("label")+"</li>"+a));v+=a}}function n(){var e=new s,d=c("<div"+e.id+' class="jq-selectbox jqselect'+e.classes+'" style="display: inline-block; position: relative; z-index:'+k.singleSelectzIndex+'"><div class="jq-selectbox__select"'+e.title+'><div class="jq-selectbox__select-text"></div><div class="jq-selectbox__trigger"><div class="jq-selectbox__trigger-arrow"></div></div></div></div>');a.css({margin:0,padding:0}).wrap('<div class="jq-selectbox-wrapper" style="display: inline-block; position: relative;"></div>').after(d);
var e=a.clone().appendTo("body"),r=e.width();e.remove();r!=a.width()&&a.parent().css("display","block");var e=c("div.jq-selectbox__select",d),l=c("div.jq-selectbox__select-text",d),r=f.filter(":selected"),g=1,z;for(z in f){if(f[z].selected)break;g=parseInt(z)+2}console.log(g);r.length?l.html('<div style="padding: 5px;" class="bubble category'+g+'_menu"></div>'+r.text()):l.html('<div style="padding: 5px;" class="bubble category'+g+'"></div>'+f.first().text());b();g="";k.selectSearch&&(g='<div class="jq-selectbox__search"><input type="search" autocomplete="off" placeholder="'+
k.selectSearchPlaceholder+'"></div>');var h=c('<div class="jq-selectbox__dropdown" style="position: absolute">'+g+'<ul style="position: relative; list-style: none; overflow: auto; overflow-x: hidden">'+v+"</ul></div>");d.append(h);var q=c("ul",h),m=c("li",h),t=c("input",h),w=c("div.jq-selectbox__not-found",h).hide();m.length<k.selectSearchLimit&&t.parent().hide();var x=0;m.each(function(){c(this).css({display:"inline-block","white-space":"nowrap"});c(this).width()>x&&(x=c(this).width());c(this).css({display:"block",
"white-space":"nowrap","text-overflow":"ellipsis",overflow:"hidden"});c(this).addClass("jq-select-element__sub")});d.width(a.outerWidth());x>h.width()&&h.width(x+h.width()-m.width());a.css({position:"absolute",opacity:0,height:d.outerHeight()});var u=d.outerHeight(),A=t.outerHeight(),y=q.css("max-height"),g=m.filter(".selected");1>g.length&&m.first().addClass("selected sel");void 0===m.data("li-height")&&m.data("li-height",m.outerHeight());var B=h.css("top");"auto"==h.css("left")&&h.css({left:0});
"auto"==h.css("top")&&h.css({top:u});h.hide();g.length&&(f.first().text()!=r.text()&&d.addClass("changed"),d.data("jqfs-class",g.data("jqfs-class")),d.addClass(g.data("jqfs-class")));if(a.is(":disabled"))return d.addClass("disabled"),!1;e.click(function(){a.focus();if(k.selectSmartPositioning){var b=c(window),f=d.offset().top,g=b.height()-u-(f-b.scrollTop()),e=k.selectVisibleOptions,l=m.data("li-height"),n=5*l,r=l*e;0<e&&6>e&&(n=r);0==e&&(r="auto");g>n+A+100?(h.height("auto").css({bottom:"auto",top:B}),
e=function(){q.css("max-height",Math.floor((g-20-A)/l)*l)},e(),q.css("max-height",r),"none"!=y&&q.css("max-height",y),g<h.outerHeight()+20&&e()):(h.height("auto").css({top:"auto",bottom:B}),e=function(){q.css("max-height",Math.floor((f-b.scrollTop()-20-A)/l)*l)},e(),q.css("max-height",r),"none"!=y&&q.css("max-height",y),f-b.scrollTop()-20<h.outerHeight()+20&&e())}c("div.jqselect").css({zIndex:k.singleSelectzIndex-1}).removeClass("opened focused");d.css({zIndex:k.singleSelectzIndex});h.is(":hidden")?
(c("div.jq-selectbox__dropdown:visible").hide(),h.fadeIn(100),d.addClass("opened")):(h.hide(),d.removeClass("opened"));m.filter(".selected").length&&(0!=q.innerHeight()/l%2&&(l/=2),q.scrollTop(q.scrollTop()+m.filter(".selected").position().top-q.innerHeight()/2+l));t.length&&(t.val("").keyup(),w.hide(),t.focus().keyup(function(){var a=c(this).val();m.each(function(){c(this).html().match(RegExp(".*?"+a+".*?","i"))?c(this).fadeIn(100):c(this).hide()});1>m.filter(":visible").length?w.fadeIn(100):w.fadeOut(100)}));
p(q);return!1});c(".bubble").hover(function(){m.removeClass("selected")});m.hover(function(){c(this).siblings().removeClass("selected")});var C=m.filter(".selected").text();m.filter(".selected").text();m.filter(":not(.disabled):not(.optgroup)").click(function(){var b=c(this),g=b.text();if(C!=g){var e=b.index();b.is(".option")&&(e-=b.prevAll(".optgroup").length);b.addClass("selected sel").siblings().removeClass("selected sel");f.prop("selected",!1).eq(e).prop("selected",!0);C=g;l.text(g);f.first().text()!=
g?d.addClass("changed"):d.removeClass("changed");d.data("jqfs-class")&&d.removeClass(d.data("jqfs-class"));d.data("jqfs-class",b.data("jqfs-class"));d.addClass(b.data("jqfs-class"));a.change()}t.length&&(t.val("").keyup(),w.fadeOut(100));h.fadeOut(100);d.removeClass("opened")});h.mouseout(function(){c("li.sel",h).addClass("selected")});a.change(function(){l.html('<div style="padding: 5px;" class="bubble category'+f.filter(":selected")[0].value+'_menu"></div>'+f.filter(":selected").text());m.removeClass("selected sel").not(".optgroup").eq(a[0].selectedIndex).addClass("selected sel")}).focus(function(){d.addClass("focused")}).blur(function(){d.removeClass("focused")}).bind("keydown keyup",
function(b){l.text(f.filter(":selected").text());m.removeClass("selected sel").not(".optgroup").eq(a[0].selectedIndex).addClass("selected sel");38!=b.which&&37!=b.which&&33!=b.which||h.scrollTop(h.scrollTop()+m.filter(".selected").position().top);40!=b.which&&39!=b.which&&34!=b.which||h.scrollTop(h.scrollTop()+m.filter(".selected").position().top-h.innerHeight()+liHeight);13==b.which&&h.fadeOut(100)});c(document).on("click",function(a){c(a.target).parents().hasClass("jq-selectbox")||"OPTION"==a.target.nodeName||
(t.length&&t.val("").keyup(),h.fadeOut(100).find("li.sel").addClass("selected"),d.removeClass("focused opened"))})}function D(){var e=new s,d=c("<div"+e.id+' class="jq-select-multiple jqselect'+e.classes+'"'+e.title+' style="display: inline-block; position: relative"></div>');a.css({margin:0,padding:0}).wrap('<div class="jq-selectbox-wrapper" style="display: inline-block; position: relative;"></div>').after(d);var e=a.clone().appendTo("body"),k=e.width();e.remove();k!=a.width()&&a.parent().css("display",
"block");b();d.append("<ul>"+v+"</ul>");var l=c("ul",d).css({position:"relative","overflow-x":"hidden","-webkit-overflow-scrolling":"touch"}),g=c("li",d).attr("unselectable","on").css({"-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","-o-user-select":"none","user-select":"none","white-space":"nowrap"}),e=a.attr("size"),k=l.outerHeight(),n=g.outerHeight();void 0!==e&&0<e?l.css({height:n*e}):l.css({height:4*n});k>d.height()&&(l.css("overflowY","scroll"),p(l),g.filter(".selected").length&&
l.scrollTop(l.scrollTop()+g.filter(".selected").position().top));a.is(":disabled")?(d.addClass("disabled"),f.each(function(){c(this).is(":selected")&&g.eq(c(this).index()).addClass("selected")}),d.width(a.outerWidth()),d.width(d.width()-(d.outerWidth()-d.width())),a.css({position:"absolute",opacity:0,height:d.outerHeight()})):(d.width(a.outerWidth()),d.width(d.width()-(d.outerWidth()-d.width())),a.css({position:"absolute",opacity:0,height:d.outerHeight()}),g.filter(":not(.disabled):not(.optgroup)").click(function(b){a.focus();
d.removeClass("focused");var e=c(this);b.ctrlKey||b.metaKey||e.addClass("selected");b.shiftKey||e.addClass("first");b.ctrlKey||b.metaKey||b.shiftKey||e.siblings().removeClass("selected first");if(b.ctrlKey||b.metaKey)e.is(".selected")?e.removeClass("selected first"):e.addClass("selected first"),e.siblings().removeClass("first");if(b.shiftKey){var k=!1,l=!1;e.siblings().removeClass("selected").siblings(".first").addClass("selected");e.prevAll().each(function(){c(this).is(".first")&&(k=!0)});e.nextAll().each(function(){c(this).is(".first")&&
(l=!0)});k&&e.prevAll().each(function(){if(c(this).is(".selected"))return!1;c(this).not(".disabled, .optgroup").addClass("selected")});l&&e.nextAll().each(function(){if(c(this).is(".selected"))return!1;c(this).not(".disabled, .optgroup").addClass("selected")});1==g.filter(".selected").length&&e.addClass("first")}f.prop("selected",!1);g.filter(".selected").each(function(){var a=c(this),b=a.index();a.is(".option")&&(b-=a.prevAll(".optgroup").length);f.eq(b).prop("selected",!0)});a.change()}),f.each(function(a){c(this).data("optionIndex",
a)}),a.change(function(){g.removeClass("selected");var a=[];f.filter(":selected").each(function(){a.push(c(this).data("optionIndex"))});g.not(".optgroup").filter(function(b){return-1<c.inArray(b,a)}).addClass("selected")}).focus(function(){d.addClass("focused")}).blur(function(){d.removeClass("focused")}),k>d.height()&&a.keydown(function(a){38!=a.which&&37!=a.which&&33!=a.which||l.scrollTop(l.scrollTop()+g.filter(".selected").position().top-n);40!=a.which&&39!=a.which&&34!=a.which||l.scrollTop(l.scrollTop()+
g.filter(".selected:last").position().top-l.innerHeight()+2*n)}))}var f=c("option",a),v="";a.is("[multiple]")?D():n()};n();a.on("refresh",function(){a.parent().before(a).remove();n()});a.on("adaptiveWidth",function(){a.css({position:"static"});a.next().width(a.outerWidth());a.css({position:"absolute"})});c(window).on("resize",function(){a.trigger("adaptiveWidth")})}}):a.is(":reset")&&a.click(function(){setTimeout(function(){a.closest(k.wrapper).find("input, select").trigger("refresh")},1)})})}})(jQuery);