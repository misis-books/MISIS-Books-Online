// ObjectStorage Advanced Library v1.0 by Alex Belov - http://twosphere.ru
// Date: 03.09.2013
// Released under the MIT license.
var ObjectStorage=function ObjectStorage(b,d){var c;b=b||"_objectStorage";ObjectStorage.instances[b]?(c=ObjectStorage.instances[b],c.duration=d||c.duration):(c=this,c._name=b,c.duration=d||500,c._init(),ObjectStorage.instances[b]=c);return c};ObjectStorage.instances={};ObjectStorage.prototype={_save:function(a){var b=JSON.stringify(this[a]);a=window[a+"Storage"];a.getItem(this._name)!==b&&a.setItem(this._name,b)},_get:function(a){this[a]=JSON.parse(window[a+"Storage"].getItem(this._name))||{}},_init:function(){var a=this;a._get("local");a._get("session");(function d(){a.timeoutId=setTimeout(function(){a._save("local");d()},a._duration)})();window.addEventListener("beforeunload",function(){a._save("local");a._save("session")})},timeoutId:null,local:{},session:{}};var Fave={storage:null,_init:function(a){this.storage||(this.storage=(new ObjectStorage(a||"faveObjects")).local,this.checkContainer()||this.createContainer());return this.storage&&this.checkContainer()?!0:!1},checkContainer:function(){return this.storage.items?!0:!1},createContainer:function(){this.storage.items=[]},add:function(a){this._init()&&!this.findById(a.id)&&(this.storage.items.push(a),this.refreshFaveCount())},clear:function(){this._init()&&(this.storage.items=[],this.refreshFaveCount())},findById:function(a){if(this._init()&&a)for(var b=0;b<this.storage.items.length;++b)if(this.storage.items[b].id==a)return this.storage.items[b];return!1},findFaveId:function(a){if(this._init()&&a)for(var b=0;b<this.storage.items.length;++b)if(this.storage.items[b].id==a)return b;return!1},removeById:function(a){this._init()&&(this.storage.items.splice(this.findFaveId(a),1),this.refreshFaveCount())},removeByFaveId:function(a){this._init()&&0<=a&&a<this.storage.items.length&&(this.storage.items.splice(a,1),this.refreshFaveCount())},getCount:function(){return this._init()?this.storage.items.length:0},refreshFaveCount:function(){0<Fave.getCount()?($("#act_fave").css({padding:"0px 27px 0px 20px"}),$(".count").css({opacity: 1, top: "8px", right: "6px"}).text(Fave.getCount())):($("#act_fave").css({padding:"0 20px"}),$(".count").css({opacity: 0, top: "-3px", right: "-1px"}))},removeAll:function(){if(this._init() && confirm("Вы действительно хотите удалить все материалы из Избранного?")){this.clear();var a=$(".content_wrapper");a.fadeOut(50);setTimeout(function(){a.empty();a.append("</span><span class='fave_no_elements'>\u0412\u044b \u043d\u0438\u0447\u0435\u0433\u043e \u043d\u0435 \u0434\u043e\u0431\u0430\u0432\u0438\u043b\u0438 \u0432 \u0418\u0437\u0431\u0440\u0430\u043d\u043d\u043e\u0435</span>");a.fadeIn(50)},50)}}};